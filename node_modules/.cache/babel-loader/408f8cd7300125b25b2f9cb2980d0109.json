{"ast":null,"code":"var _jsxFileName = \"/Users/TravelComputer/Desktop/node_sandbox/reactapp/node_modules/react-komponent/src/components/signIn.jsx\";\nimport React from 'react';\nimport { auth } from '../firebase/firebase';\nimport { signInWithGoogle, createUserProfileDocument, firestore } from '../firebase/firebase';\nimport Component from '../components/component';\n\nconst updateUserField = (email, update) => {\n  firestore.collection(\"users\").where(\"email\", \"==\", email).get().then(gt => {\n    const docs = gt.docs;\n    docs.forEach(doc => {\n      const docRef = doc.ref;\n      docRef.update(update);\n    });\n  });\n};\n/*\nclass SignIn extends React.Component {\n   constructor(props) {\n      super(props)\n      this.state = props.user\n      this.setTheState = function(...args) {\n         this.setState(...args)\n         props.newState(arguments[0])\n      }\n   }\n   */\n\n\nclass User extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loggedUser: null,\n      dbUser: null,\n      displayName: '',\n      email: '',\n      password: '',\n      loggingIn: false,\n      loggingOut: false,\n      method: ''\n    };\n  }\n\n  componentDidMount() {\n    console.log('component mounting');\n    let thiss = this;\n    let loggedUser;\n    let displayName;\n    let email;\n    let password;\n    let dbUser;\n    let loggingOut;\n    let loggingIn;\n    thiss.unAuth = auth.onAuthStateChanged(async function (user) {\n      console.log('entering auth state change hook');\n\n      if (thiss.state.loggingOut) {\n        updateUserField(thiss.state.dbUser.email, {\n          loggedIn: false\n        });\n        thiss.setState({\n          loggedUser: null,\n          dbUser: null,\n          method: null,\n          loggingOut: false\n        }, () => console.log('setting state from auth state change -- user is logging out'));\n        return;\n      }\n\n      if (!user) return;\n\n      if (thiss.state.loggingIn) {\n        loggedUser = user;\n        updateUserField(user.email, {\n          loggedIn: true\n        });\n      }\n\n      email = user.email;\n      displayName = user.displayName;\n      password = '';\n      dbUser = await createUserProfileDocument(user, {});\n      dbUser = dbUser ? dbUser.loggedUser : null;\n      dbUser = dbUser || user;\n      thiss.setState({\n        loggedUser,\n        dbUser,\n        email,\n        displayName,\n        password,\n        loggingIn: false\n      }, () => {\n        console.log('setting state from auth state change callback', thiss.state);\n      }); // if (!loggedUser) { signInWithGoogle() }\n    });\n    this.setState({\n      loggedUser,\n      email,\n      displayName,\n      password,\n      dbUser\n    }, () => console.log('setting state after component mounting', this.state));\n  } // componentWillUnmount() { console.log('unmounting'); this.unAuth() }\n\n\n  render() {\n    console.log('rendering', this.state);\n    console.log();\n    const thiss = this;\n\n    const handleGoogle = event => {\n      console.log('signing in with google');\n      thiss.state.method = 'google';\n      thiss.state.loggingIn = true;\n      event.preventDefault();\n\n      if (thiss.state.dbUser) {\n        const userRef = firestore.doc(`users/${thiss.state.dbUser.uid}`);\n        const snapShot = userRef.get().then(res => {\n          if (!res.exists) {\n            signInWithGoogle();\n            return;\n          }\n\n          thiss.setState({\n            loggedUser: res\n          }, () => console.log('setting state from snapShot from google sign in'));\n        });\n      } else {\n        signInWithGoogle().then(sign => {\n          if (sign.user) {\n            thiss.setState({\n              loggedUser: sign.user,\n              dbUser: sign.user\n            }, () => console.log('setting state from google signin'));\n          } else {}\n        });\n      }\n    };\n\n    const handleSignIn = event => {\n      thiss.state.method = 'email';\n      thiss.state.loggingIn = true;\n      const {\n        email,\n        password\n      } = thiss.state;\n      console.log('signing in with email and pass');\n      event.preventDefault();\n      let signin = auth.signInWithEmailAndPassword(email, password).then(sign => {\n        alert('signin success');\n        thiss.setState({\n          loggedUser: sign.user,\n          dbUser: sign.user\n        }, () => console.log('setting state from user signin'));\n      }).catch(err => alert('signin fail: ' + err.message));\n    };\n\n    const handleSubmit = event => {\n      console.log('submit event', event.target);\n      event.preventDefault();\n    };\n\n    const handleChange = event => {\n      console.log('event-on-change', event.target);\n      const {\n        name,\n        value\n      } = event.target;\n      thiss.setState({\n        [name]: value\n      }, () => console.log('setting state from handlechange'));\n    };\n\n    const signOut = event => {\n      console.log('signing out');\n      this.state.loggingOut = true;\n      auth.signOut();\n    };\n\n    const newUser = event => {\n      thiss.state.method = 'new signup';\n      thiss.state.loggingIn = true;\n      const {\n        email,\n        password\n      } = thiss.state;\n      console.log('new user');\n      event.preventDefault();\n      let signin = auth.createUserWithEmailAndPassword(email, password).then(sign => {\n        alert('signup success');\n        console.log('sign', sign);\n        console.log('state before setting', thiss.state);\n        thiss.setState({\n          loggedUser: sign.user,\n          dbUser: sign.user\n        }, () => console.log('setting state from new user signup', thiss.state));\n      }).catch(err => alert('sign up fail: ' + err.message));\n    };\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 7\n      }\n    }, !this.state.loggedUser ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      id: \"signInHeader\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 10\n      }\n    }, \"Sign In Here!!!!\"), /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 10\n      }\n    }, \"I already have an account\"), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 13\n      }\n    }, \"email:\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 34\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"email\",\n      name: \"email\",\n      onChange: handleChange,\n      required: true,\n      value: this.state.email,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 106\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 13\n      }\n    }, \"password:\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"password\",\n      name: \"password\",\n      onChange: handleChange,\n      value: this.state.password,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: event => handleSignIn(event),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 10\n      }\n    }, \"Sign in with your email and password.\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: event => handleGoogle(event),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 10\n      }\n    }, \"Sign in with Google\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: event => newUser(event),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 10\n      }\n    }, \"Sign up with Email and password.\")) : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 12\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 13\n      }\n    }, \"You are logged in with \", thiss.state.method), console.log('me!!!', this.state), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => signOut(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 13\n      }\n    }, \"Sign Out\")));\n  }\n\n}\n\nexport class Random extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      thing1: 'thing1',\n      thing2: 'thing2'\n    };\n  }\n\n  render() {\n    console.log('random state', this.useSelector(state => state));\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 14\n      }\n    }, \"This is very random\");\n  }\n\n}\nexport default User;","map":{"version":3,"sources":["/Users/TravelComputer/Desktop/node_sandbox/reactapp/node_modules/react-komponent/src/components/signIn.jsx"],"names":["React","auth","signInWithGoogle","createUserProfileDocument","firestore","Component","updateUserField","email","update","collection","where","get","then","gt","docs","forEach","doc","docRef","ref","User","constructor","props","state","loggedUser","dbUser","displayName","password","loggingIn","loggingOut","method","componentDidMount","console","log","thiss","unAuth","onAuthStateChanged","user","loggedIn","setState","render","handleGoogle","event","preventDefault","userRef","uid","snapShot","res","exists","sign","handleSignIn","signin","signInWithEmailAndPassword","alert","catch","err","message","handleSubmit","target","handleChange","name","value","signOut","newUser","createUserWithEmailAndPassword","Random","thing1","thing2","useSelector"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { auth } from '../firebase/firebase'\nimport { signInWithGoogle, createUserProfileDocument, firestore } from '../firebase/firebase'\nimport Component from '../components/component'\n\nconst updateUserField = (email,update) => {\n   firestore.collection(\"users\").where(\"email\", \"==\", email).get().then(gt => { \n      const docs = gt.docs\n      docs.forEach(doc => {\n         const docRef = doc.ref\n         docRef.update(update)\n      })\n   })\n}\n/*\nclass SignIn extends React.Component {\n   constructor(props) {\n      super(props)\n      this.state = props.user\n      this.setTheState = function(...args) {\n         this.setState(...args)\n         props.newState(arguments[0])\n      }\n   }\n   */\nclass User extends Component {\n   constructor(props) {\n      super(props)\n      this.state = {\n         loggedUser: null,\n         dbUser: null,\n         displayName: '',\n         email: '',\n         password: '',\n         loggingIn: false,\n         loggingOut: false,\n         method: ''\n      }\n   }\n   componentDidMount() {\n      console.log('component mounting')\n      let thiss = this;\n      let loggedUser; let displayName; let email; let password; let dbUser; let loggingOut; let loggingIn;\n      thiss.unAuth = auth.onAuthStateChanged(async function(user) {\n         console.log('entering auth state change hook')\n         if (thiss.state.loggingOut) {\n            updateUserField(thiss.state.dbUser.email,{loggedIn:false})\n            thiss.setState({ loggedUser:null,dbUser:null, method: null, loggingOut:false },() => console.log('setting state from auth state change -- user is logging out'))\n            return\n         }\n         if (!user) return\n         if (thiss.state.loggingIn) { \n            loggedUser = user\n            updateUserField(user.email,{loggedIn:true})\n         }\n         email = user.email\n         displayName = user.displayName\n         password = ''\n         dbUser = await createUserProfileDocument(user,{})\n         dbUser = dbUser ? dbUser.loggedUser : null\n         dbUser = dbUser || user\n         thiss.setState({loggedUser, dbUser, email,displayName,password,loggingIn:false},() => {console.log('setting state from auth state change callback',thiss.state)})\n         // if (!loggedUser) { signInWithGoogle() }\n      })\n      this.setState({loggedUser,email,displayName,password,dbUser},() => console.log('setting state after component mounting',this.state))\n   }\n   // componentWillUnmount() { console.log('unmounting'); this.unAuth() }\n   render() {\n      console.log('rendering',this.state)\n      console.log()\n      const thiss = this\n      const handleGoogle  = event => {\n         console.log('signing in with google')\n         thiss.state.method = 'google'\n         thiss.state.loggingIn = true\n         event.preventDefault()\n         if (thiss.state.dbUser) {\n            const userRef = firestore.doc(`users/${thiss.state.dbUser.uid}`);\n            const snapShot = userRef.get().then(res => {\n               if (!res.exists) { signInWithGoogle(); return }\n               thiss.setState({loggedUser:res},() => console.log('setting state from snapShot from google sign in'))\n            })\n         } else {\n            signInWithGoogle().then(sign => {\n               if (sign.user) {\n                  thiss.setState({loggedUser:sign.user,dbUser:sign.user},() => console.log('setting state from google signin'))\n               } else { }\n            })\n         }\n      }\n      const handleSignIn = event => {\n         thiss.state.method = 'email'\n         thiss.state.loggingIn = true\n         const { email,password } = thiss.state\n         console.log('signing in with email and pass')\n         event.preventDefault()\n         let signin = auth.signInWithEmailAndPassword(email,password)\n         .then(sign => {\n            alert('signin success')\n            thiss.setState({loggedUser:sign.user,dbUser:sign.user},() => console.log('setting state from user signin'))\n         })\n         .catch(err => alert('signin fail: '+err.message))\n      }\n      const handleSubmit = event => {\n         console.log('submit event',event.target)\n         event.preventDefault()\n      }\n      const handleChange = event => {\n         console.log('event-on-change',event.target)\n         const { name,value } = event.target\n         thiss.setState({[name]: value},() => console.log('setting state from handlechange'))\n      }\n      const signOut = event => {\n         console.log('signing out')\n         this.state.loggingOut = true\n         auth.signOut()\n      }\n      const newUser = event => {\n         thiss.state.method = 'new signup'\n         thiss.state.loggingIn = true\n         const { email,password } = thiss.state\n         console.log('new user')\n         event.preventDefault()\n         let signin = auth.createUserWithEmailAndPassword(email, password)\n         .then(sign => {\n            alert('signup success')\n            console.log('sign',sign)\n            console.log('state before setting',thiss.state)\n            thiss.setState({loggedUser:sign.user,dbUser:sign.user},() => console.log('setting state from new user signup',thiss.state))\n         })\n         .catch(err => alert('sign up fail: '+err.message))\n      }\n      return (\n      <div className=\"App\">\n         {\n         !this.state.loggedUser ?\n         <div>\n         <h2 id=\"signInHeader\">Sign In Here!!!!</h2>\n         <h2>I already have an account</h2>\n         <form onSubmit={handleSubmit}>\n            <label>email:</label><br />\n            <input type=\"email\" name=\"email\" onChange={handleChange} required value={this.state.email} /><br />\n            <label>password:</label><br />\n            <input type=\"password\" name=\"password\" onChange={handleChange} value={this.state.password} />\n            <input type=\"submit\" value=\"Submit\"></input>\n         </form>\n         <button onClick={(event) => handleSignIn(event)}>Sign in with your email and password.</button>\n         <button onClick={(event) => handleGoogle(event)}>Sign in with Google</button>\n         <button onClick={(event) => newUser(event)}>Sign up with Email and password.</button>\n         </div>\n         : <div>\n            <h1>You are logged in with {thiss.state.method}</h1>\n            {console.log('me!!!',this.state)}\n            <button onClick={() => signOut()}>Sign Out</button>\n         </div>\n         }  \n      </div>\n      )\n   }\n}\nexport class Random extends Component {\n   constructor(props) {\n      super(props)\n      this.state = {\n         thing1: 'thing1',\n         thing2: 'thing2'\n      }\n   }\n   render() {\n      console.log('random state',this.useSelector(state => state))\n      return <div>This is very random</div> \n   }\n}\n\nexport default User"]},"metadata":{},"sourceType":"module"}